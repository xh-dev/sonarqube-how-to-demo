### Introduction
This is a demo for the start up the `sonarqube` from docker environment.
The source code is on [[GitHub](https://github.com/xh-dev/sonarqube-how-to-demo)]
**Please be awared that this demo is not a production grade demo, please double check for any securtity issue before go production with / based on this code base.**

**Clone the project with below script.**
```shell
git clone https://github.com/xh-dev/sonarqube-how-to-demo.git
```

### IaC setups
The IaC is achieving through the `terraform` and `ansible`. I use the `terraform` for the cloud VM provissioning and then use the `ansible` for the detail VM configuration. The cloud provide for this project is `Linode`, user with other cloud provider, please modify the terraform configuration to meet their cloud platform needs.

#### Prerequisite
Before we could start with the demo, the demo requires some basic setups
1. terraform installed
2. ansible installed
3. python 3+ installed

#### Initialzed and execute provisioning

1. Please create a `init.auto.tfvars` for storing neccessary secrete of variables. 
	```shell
	linode_token="{linode token}"
	root_pass="{VM root password}"
	ssh_key="{ssh access key}"
	```

	The project requires three terraform variables to be provided for making the terraform works.

2. Once the `init.auto.tfvars` ready, execute command to initialize the terraform project
	```shell
	terraform init
	```

3. After the terraform project initialized, execute command to apply the change to the cloud platform.
	```shell
	# auto-approve for not prompt the for confirmation
	terraform apply --auto-approve
	```

4. Once the cloud VM is provissioned, we could start generating required shell script for configuration of the project.
	```shell
	python main.py
	```

	After executing above command you would observe a few files are generated(e.g. `inventory.yaml`, `init.sh`, `setup_hots.sh`, etc.).

	All the scripts are generated based on the IP address of new VM generated by the `terraform`, `init.sh` is the command initializing the whole configuration process.
	```shell
	source init.sh
	```

	After execute the command you would observe a list of operation happens, including,
	1. register `known_hosts`
	2. apply system update, installation of docker, and system configuration through `ansible`
	3. copy the docker compose to the remote VM through `SCP`

5. SSH into the remote server and start up the docker with `docker-compose.yaml`
	```shell
	# if executed `source init.sh`, the IP address of the VM is stored as environment variable in `ip`
	ssh root@$ip

	cd ~/sonarqube
	docker compose up
	```
	
6. After the command running complete and show web server started. User is able to access the sonarqube dashboard through public IP address.
	```shell
	curl "http:$ip:9000"
	```

